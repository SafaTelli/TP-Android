
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.3">
    
    
      
        <title>TP3: Création des Fragments - TP-Android-GL4 2022-2023</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6b80c2a2.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fragments-menus" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TP-Android-GL4 2022-2023" class="md-header__button md-logo" aria-label="TP-Android-GL4 2022-2023" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TP-Android-GL4 2022-2023
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TP3: Création des Fragments
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TP-Android-GL4 2022-2023" class="md-nav__button md-logo" aria-label="TP-Android-GL4 2022-2023" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    TP-Android-GL4 2022-2023
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp0/" class="md-nav__link">
        TP0: Intitiation au langage Kotlin
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp1/" class="md-nav__link">
        TP1: Création des interfaces graphiques et navigation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp2/" class="md-nav__link">
        TP2: Éléments Graphiques avancés : RecyclerView
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          TP3: Création des Fragments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        TP3: Création des Fragments
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs-du-tp" class="md-nav__link">
    Objectifs du TP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rappel" class="md-nav__link">
    Rappel
  </a>
  
    <nav class="md-nav" aria-label="Rappel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fragment" class="md-nav__link">
    Fragment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-fragment" class="md-nav__link">
    Création d'un fragment
  </a>
  
    <nav class="md-nav" aria-label="Création d'un fragment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-creer-un-nouveau-fragment-a-laide-de-android-studio" class="md-nav__link">
    1. Créer un nouveau fragment à l'aide de Android Studio.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ajouter-le-fragment-a-une-activite" class="md-nav__link">
    2. Ajouter le fragment à une activité
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ii-exercice-1-fragments" class="md-nav__link">
    II. Exercice 1 : Fragments
  </a>
  
    <nav class="md-nav" aria-label="II. Exercice 1 : Fragments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creation-des-fragments" class="md-nav__link">
    2. Création des fragments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creation-de-lactivite-principale" class="md-nav__link">
    3. Création de l’activité principale
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii-menus" class="md-nav__link">
    III. Menus
  </a>
  
    <nav class="md-nav" aria-label="III. Menus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-menus-doptions-et-action-bar" class="md-nav__link">
    1. Menus d’options et Action Bar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv-exercice-2-action-bar" class="md-nav__link">
    IV. Exercice 2 : Action Bar
  </a>
  
    <nav class="md-nav" aria-label="IV. Exercice 2 : Action Bar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif_1" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-implementation" class="md-nav__link">
    2. Implémentation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v-menu-contextuel" class="md-nav__link">
    V. Menu Contextuel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-exercice-3-menu-contextuel" class="md-nav__link">
    VI. Exercice 3 : Menu Contextuel
  </a>
  
    <nav class="md-nav" aria-label="VI. Exercice 3 : Menu Contextuel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif_2" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-definir-le-menu-contextuel" class="md-nav__link">
    2. Définir le Menu Contextuel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-definir-le-callback" class="md-nav__link">
    3. Définir le Callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-associer-le-callback-a-un-evenement" class="md-nav__link">
    4. Associer le callback à un événement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homework" class="md-nav__link">
    Homework
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp4/" class="md-nav__link">
        TP4: Stockage de données et Firebase
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp6/" class="md-nav__link">
        TP5: Connexion à des services web REST
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs-du-tp" class="md-nav__link">
    Objectifs du TP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rappel" class="md-nav__link">
    Rappel
  </a>
  
    <nav class="md-nav" aria-label="Rappel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fragment" class="md-nav__link">
    Fragment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creation-dun-fragment" class="md-nav__link">
    Création d'un fragment
  </a>
  
    <nav class="md-nav" aria-label="Création d'un fragment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-creer-un-nouveau-fragment-a-laide-de-android-studio" class="md-nav__link">
    1. Créer un nouveau fragment à l'aide de Android Studio.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ajouter-le-fragment-a-une-activite" class="md-nav__link">
    2. Ajouter le fragment à une activité
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ii-exercice-1-fragments" class="md-nav__link">
    II. Exercice 1 : Fragments
  </a>
  
    <nav class="md-nav" aria-label="II. Exercice 1 : Fragments">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creation-des-fragments" class="md-nav__link">
    2. Création des fragments
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creation-de-lactivite-principale" class="md-nav__link">
    3. Création de l’activité principale
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii-menus" class="md-nav__link">
    III. Menus
  </a>
  
    <nav class="md-nav" aria-label="III. Menus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-menus-doptions-et-action-bar" class="md-nav__link">
    1. Menus d’options et Action Bar
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iv-exercice-2-action-bar" class="md-nav__link">
    IV. Exercice 2 : Action Bar
  </a>
  
    <nav class="md-nav" aria-label="IV. Exercice 2 : Action Bar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif_1" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-implementation" class="md-nav__link">
    2. Implémentation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v-menu-contextuel" class="md-nav__link">
    V. Menu Contextuel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vi-exercice-3-menu-contextuel" class="md-nav__link">
    VI. Exercice 3 : Menu Contextuel
  </a>
  
    <nav class="md-nav" aria-label="VI. Exercice 3 : Menu Contextuel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif_2" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-definir-le-menu-contextuel" class="md-nav__link">
    2. Définir le Menu Contextuel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-definir-le-callback" class="md-nav__link">
    3. Définir le Callback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-associer-le-callback-a-un-evenement" class="md-nav__link">
    4. Associer le callback à un événement
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#homework" class="md-nav__link">
    Homework
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="fragments-menus">Fragments &amp; Menus</h1>
<p><img alt="Screenshot" src="../assets/tp3/fragments.png" /></p>
<h2 id="objectifs-du-tp">Objectifs du TP</h2>
<ul>
<li>Dans ce TP nous allons travailler avec les fragments et les menus.</li>
</ul>
<h2 id="rappel">Rappel</h2>
<h3 id="fragment">Fragment</h3>
<p>Un fragment représente un comportement ou une portion d’interface utilisateur dans une activité. Il est possible de combiner plusieurs fragments dans une seule activité pour construire une interface à plusieurs panneaux, et réutiliser un fragment dans plusieurs activités.
Un fragment a son propre cycle de vie, reçoit ses propres entrées et peut être ajouté, modifié ou supprimé de manière dynamique. Il est toujours inclus dans une activité, et son cycle de vie est directement affecté par celui de l’activité qui le contient. Tant que l’activité conteneur est en état d’exécution, le fragment peut être manipulé de manière indépendante (ajouté, modifié ou supprimé). Mais si l’activité est détruite, le fragment l’est aussi.
A la base, les fragments ont été créés pour supporter la conception d’interfaces graphiques flexibles sur des écrans de tailles différentes, et permettre ainsi aux appareils dont la taille d’écran est plus importante (comme les tablettes) de profiter de cet espace pour combiner et inter-changer des composants graphiques.
<img alt="Image title" src="../assets/tp3/fragment1.png" /></p>
<h3 id="creation-dun-fragment">Création d'un fragment</h3>
<p>Pour créer un fragment, il faut créer une classe qui hérite de android.app.Fragment, ou une de ses sous-classes. Parmi ces sous-classes on peut citer:</p>
<ul>
<li>
<p>DialogFragment :
Affiche une boîte de dialogue flottante au lieu d’utiliser des méthodes dans votre activité, car il peut être rajouté à la pile des fragments de l’activité.
<img alt="Image title" src="../assets/tp3/dialog.jpeg" /></p>
</li>
<li>
<p>ListFragment: Affiche une liste d’éléments gérés par un adaptateur, et fournit ainsi plusieurs méthodes pour gérer une listView.</p>
</li>
</ul>
<p><center><img alt="Image title" height="200" src="../assets/tp3/listfragment.jpeg" /></center></p>
<ul>
<li>PreferenceFragment: Affiche une hiérarchie d’objets Preference comme liste. Permet de créer une activité de type settings pour votre application.</li>
</ul>
<p><center><img alt="Image title" height="200" src="../assets/tp3/preferences.png" /></center></p>
<p>Pour créer un fragment, il faut suivre les étapes suivantes :</p>
<h4 id="1-creer-un-nouveau-fragment-a-laide-de-android-studio">1. Créer un nouveau fragment à l'aide de Android Studio.</h4>
<p><center><img alt="Image title" height="200" src="../assets/tp3/creer.png" /></center></p>
<h4 id="2-ajouter-le-fragment-a-une-activite">2. Ajouter le fragment à une activité</h4>
<p>Le fragment peut être ajouté de manière statique ou dynamique à l’activité.</p>
<ul>
<li>
<p>Statique : Déclarer le fragment dans le fichier layout XML de l’activité, grâce à l’élément XML <strong>androidx.fragment.app.FragmentContainerView</strong>. Pour cela, indiquer comme attribut <em>android:name</em> la classe Java du fragment à instancier dans le layout. Dans ce cas on ne peut pas gérer (remplacer,supprimer, ajouter) notre fragment à l'exécution.</p>
</li>
<li>
<p>Dynamique : Dans ce cas, on peut gérer notre fragment à l'exécution, en déclarant un <em>FrameLayout</em> dans le fichier layout XML de l'activité. Pour gérer notre fragment on doit utiliser un <em>FragmentManager</em>.</p>
</li>
</ul>
<p>Un FragmentManager permet de gérer les fragments d’une activité particulière. Pour l’utiliser, il suffit d’appeler directement <strong>supportFragmentManager</strong> à partir de n’importe quel emplacement de votre activité.
  Le FragmentManager permet de :</p>
<ul>
<li>
<p>Manipuler les fragments existants dans votre application grâce aux méthodes findFragmentById() ou findFragmentByTag()</p>
</li>
<li>
<p>Gérer la pile de retour (Back Stack), accessible via le bouton Back de l’appareil</p>
<ul>
<li>Dépiler un fragment de la pile, avec popBackStack()</li>
<li>Associer un Listener aux changements de cette pile avec  addOnBackStackChangedListener()</li>
</ul>
</li>
</ul>
<p>La manipulation des fragments par le FragmentManager est possible grâce à un ensemble de FragmentTransactions. Une transaction est une opération sur des fragments (ajout, suppression, remplacement…) dans une activité, en réponse à une interaction utilisateur.
Une transaction peut être stockée dans la pile de retour de l’activité, pour permettre à l’utilisateur de revenir en arrière, grâce à la méthode addToBackStack().</p>
<h2 id="ii-exercice-1-fragments">II. Exercice 1 : Fragments</h2>
<h3 id="1-objectif">1. Objectif</h3>
<p>L’objectif de cet exercice est de montrer comment créer et inter-changer des fragments dans une application Android. L’objectif est d’obtenir le résultat suivant :</p>
<p><img alt="Exercice 1" src="../assets/tp3/exer1.png" /></p>
<h3 id="2-creation-des-fragments">2. Création des fragments</h3>
<p>Pour créer les fragments, commencer par :</p>
<ol>
<li>Créer une application avec une simple activité vide.</li>
<li>Créer le layout pour le premier fragment. Pour cela, créer un fichier frag_digital.xml sous le répertoire layout, y insérer un objet AnalogClock, et utiliser la couleur d’arrière plan de votre choix</li>
<li>Faire de même pour créer un fragment frag_numeric avec une horloge de type TextClock</li>
<li>Créer une classe FragmentClock qui étend la classe Fragment.
La première chose à faire est d’implémenter la méthode onCreateView qui représente le comportement du fragment dès son apparition. Dans cette méthode, nous allons indiquer quel fragment charger. Pour charger le fragment frag_digital, par exemple, la méthode onCreateView doit retourner :</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">inflater</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">frag_digital</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Laisser l ’implémentation de cette partie pour plus tard.</p>
<h3 id="3-creation-de-lactivite-principale">3. Création de l’activité principale</h3>
<p>Pour créer l’activité principale :</p>
<ul>
<li>Commencer par créer son interface. Pour cela, commencer par insérer un switch et un bouton côte à côte. Le bouton définit comme méthode onClick la fonction : setTime</li>
<li>Créer une balise <strong><em>androidx.fragment.app.FragmentContainerView</em></strong> qui va contenir le fragment en question.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>  <span class="nt">&lt;androidx.fragment.app.FragmentContainerView</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>      <span class="na">android:id=</span><span class="s">&quot;@+id/fragment&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>      <span class="na">android:layout_height=</span><span class="s">&quot;0dp&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>      <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&quot;parent&quot;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>      <span class="nt">&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  <span class="nt">&lt;/androidx.fragment.app.FragmentContainerView&gt;</span>
</code></pre></div>
<p>L’objectif étant de cliquer sur le bouton Set, puis d’afficher l’horloge digitale si le switch est activé, et l’horloge numérique s’il est désactivé. Il faut donc maintenant implémenter la fonction setTime.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTime</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">       </span><span class="kd">var</span><span class="w"> </span><span class="n">fragmentManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">supportFragmentManager</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">       </span><span class="kd">var</span><span class="w"> </span><span class="n">transaction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragmentManager</span><span class="p">.</span><span class="na">beginTransaction</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">       </span><span class="kd">var</span><span class="w"> </span><span class="n">fragmentClock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FragmentClock</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">       </span><span class="kd">var</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bundle</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">       </span><span class="n">bundle</span><span class="p">.</span><span class="na">putBoolean</span><span class="p">(</span><span class="s">&quot;digitalOK&quot;</span><span class="p">,</span><span class="n">binding</span><span class="p">.</span><span class="na">switchWidget</span><span class="p">.</span><span class="na">isChecked</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">       </span><span class="n">fragmentClock</span><span class="p">.</span><span class="na">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bundle</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">       </span><span class="n">transaction</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">fragment</span><span class="p">,</span><span class="n">fragmentClock</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">       </span><span class="n">transaction</span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>L’objet Bundle permet d’envoyer une ensemble de paramètres, sous format clef/valeur, au fragment. En l’occurrence, dans notre cas, nous allons lui envoyer l’état du switch (checked ou unchecked), dans le paramètre booléen digitalOK.
Le fragment manager va se charger de placer le fragment à l’endroit qui lui est associé, soit dans la balise <strong><em>FragmentContainerView</em></strong></p>
<p>Pour définir quel fragment charger, modifier le code de la classe FragmentClock comme suit :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">IS_DIGITAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;digitalOK&quot;</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kd">class</span> <span class="nc">FragmentClock</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Fragment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="c1">// TODO: Rename and change types of parameters</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">digitalClock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">        </span><span class="n">arguments</span><span class="o">?</span><span class="p">.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">            </span><span class="n">digitalClock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="na">getBoolean</span><span class="p">(</span><span class="n">IS_DIGITAL</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onCreateView</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">        </span><span class="n">inflater</span><span class="p">:</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">        </span><span class="n">container</span><span class="p">:</span><span class="w"> </span><span class="n">ViewGroup</span><span class="o">?</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle</span><span class="o">?</span><span class="w"></span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="p">):</span><span class="w"> </span><span class="n">View</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">digitalClock</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">            </span><span class="n">inflater</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">fragment_numeric</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">        </span><span class="k">else</span><span class="w"></span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">            </span><span class="n">inflater</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">fragment_digital</span><span class="p">,</span><span class="w"> </span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
Initielemnt : Au moment du lancement de notre activité, on doit insérer notre fragment dynamiquement pour pouvoir le remplacer ultérieurement. Pour cela on doit utiliser le <em>FragmentManager</em> dans la méthode <em>onCreate</em> de l'activité.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">     </span><span class="n">supportFragmentManager</span><span class="p">.</span><span class="na">beginTransaction</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">            </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">fragment</span><span class="p">,</span><span class="n">FragmentClock</span><span class="p">(),</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">            </span><span class="p">.</span><span class="na">addToBackStack</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">            </span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Activité 1</p>
<p>Réaliser l’application comme indiqué dans les étapes précédentes. Lancer l’émulateur pour tester votre code.</p>
</div>
<h2 id="iii-menus">III. Menus</h2>
<h3 id="1-menus-doptions-et-action-bar">1. Menus d’options et Action Bar</h3>
<p>Les APIs Menu étaient à la base destinées à définir le comportement (entre autres) du bouton menu du téléphone qui, depuis la version 3.0 est devenu obsolète. Étant donné que plusieurs terminaux récents ne possèdent plus ce bouton, il a été nécessaire de remplacer ce type de menus.
Désormais, les fonctionnalités du menu d’options sont définies dans le Action Bar:
<center><img alt="Menu" src="../assets/tp3/menu.png" /></center></p>
<p>La barre d'action (Action Bar) est une caractéristique qui identifie l'emplacement de l'utilisateur et lui fournit des actions et des modes de navigation. Elle fournit un espace dédié pour donner à votre application une identité et indiquer où se trouve l’utilisateur dans l’application, un ensemble d’actions importantes est accessibles comme la recherche par exemple, une navigation consistante et la possibilité de changer de vue dans une application grâce aux tabulations ou listes déroulantes.
Dans les applications que vous créez par défaut avec Android Studio, vous allez trouver une barre d’action qui est ajoutée automatiquement. Le contenu de cette barre est décrit dans un fichier XML que vous trouverez sous le répertoire menu. Chaque élément de la barre sera représenté comme un nouvel item.</p>
<p>L’attribut showAsAction permet de configurer l’apparition de l’élément dans la barre ou bien dans le Action Overflow (  ). Plusieurs valeurs sont possibles, dont : never, always ou ifRoom. Pour définir le comportement des éléments de la barre d’action, il faut implémenter les méthodes (automatiquement générées):</p>
<ul>
<li>onCreateOptionsMenu : construit le menu en appelant le contenu du menu XML</li>
<li>onOptionsItemSelected : définit le comportement de chacune des actions de la barre</li>
</ul>
<h2 id="iv-exercice-2-action-bar">IV. Exercice 2 : Action Bar</h2>
<h3 id="1-objectif_1">1. Objectif</h3>
<p>L’objectif est d’ajouter des éléments à la barre d’actions de l’exercice précédent. Le rendu final sera comme suit :
<center><img alt="Menu" src="../assets/tp3/exer2.png" /></center></p>
<h3 id="2-implementation">2. Implémentation</h3>
<ul>
<li>Créer un nouveau dossier de ressources sous le dossier <strong>res</strong> et choisir le type de fichier <strong>menu</strong>.</li>
<li>Sous le dossier menu crée, créer un nouveau fichier <strong>Menu Ressource File</strong>.</li>
<li>Ajouter dans le fichier un élément switch, et associez-lui une icône, en précisant qu’il doit toujours être affiché dans la barre d’options :</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">&lt;item</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>      <span class="na">android:id=</span><span class="s">&quot;@+id/action_switch&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>      <span class="na">android:orderInCategory=</span><span class="s">&quot;100&quot;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>      <span class="na">android:icon=</span><span class="s">&quot;@drawable/refresh&quot;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>      <span class="na">app:showAsAction=</span><span class="s">&quot;always&quot;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>      <span class="na">android:title=</span><span class="s">&quot;@string/action_refresh&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>   <span class="nt">&lt;/item&gt;</span>
</code></pre></div>
<ul>
<li>
<p>Dans votre activité implementer la fonction <strong>onCreateOptionsMenu</strong>, comme suit :
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onCreateOptionsMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">:</span><span class="w"> </span><span class="n">Menu</span><span class="o">?</span><span class="p">):</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="n">inflater</span><span class="p">:</span><span class="w"> </span><span class="n">MenuInflater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menuInflater</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="n">inflater</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">menu</span><span class="p">.</span><span class="na">menu</span><span class="p">,</span><span class="w"> </span><span class="n">menu</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div></p>
</li>
<li>
<p>Implémenter la fonction onOptionsItemSelected, comme suit :</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onOptionsItemSelected</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="n">MenuItem</span><span class="p">):</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">itemId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">action_switch</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">            </span><span class="n">binding</span><span class="p">.</span><span class="na">switchWidget</span><span class="p">.</span><span class="na">isChecked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">binding</span><span class="p">.</span><span class="na">switchWidget</span><span class="p">.</span><span class="na">isChecked</span><span class="w"></span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">            </span><span class="nf">setTime</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">onOptionsItemSelected</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Activité 2</p>
<p>Créer l’action Bar précédente dans votre application.</p>
</div>
<h2 id="v-menu-contextuel">V. Menu Contextuel</h2>
<p>Un menu contextuel est un menu flottant qui apparaît quand un utilisateur fait un clic long sur un élément, par exemple. Il fournit des actions qui affectent le contenu cliqué et/ou son conteneur.</p>
<p>À partir de la version 3 d’Android, ce menu a été remplacé par un mode contextuel permettant de réaliser des actions sur le contenu sélectionné. Il affiche les actions qui affectent le contenu sélectionné dans une barre en haut de l’écran et permet à l’utilisateur de sélectionner plusieurs éléments au besoin.</p>
<p>En général, on change vers le mode contextuel si l’utilisateur fait un clic long sur un élément, ou s’il sélectionne une case à cocher (ou autre élément équivalent). La barre d’action contextuelle prend alors momentanément la place de la barre d’action.
Il est possible d’activer ce mode pour un widget individuel, ou bien pour un groupe d’éléments regroupés dans une liste ou une grille, par exemple.</p>
<p><center><img alt="Menu Contextuel" src="../assets/tp3/contextuel.png" /></center></p>
<h2 id="vi-exercice-3-menu-contextuel">VI. Exercice 3 : Menu Contextuel</h2>
<h3 id="1-objectif_2">1. Objectif</h3>
<p>L’objectif est d’activer le mode contextuel si l’utilisateur fait un appui long sur le bouton. Dans la barre contextuelle, l’utilisateur pourra alors changer la couleur du bouton.</p>
<p><center><img alt="Exercice 3" src="../assets/tp3/exer3.png" /></center></p>
<h3 id="2-definir-le-menu-contextuel">2. Définir le Menu Contextuel</h3>
<p>Pour définir le contenu de la barre contextuelle, il faut ajouter un autre fichier xml dans le répertoire menu. On l’appellera context_mode_menu.xml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">&lt;menu</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="na">xmlns:app=</span><span class="s">&quot;http://schemas.android.com/apk/res-auto&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="nt">&lt;item</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>        <span class="na">android:id=</span><span class="s">&quot;@+id/action_color&quot;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>        <span class="na">app:showAsAction=</span><span class="s">&quot;always&quot;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="na">android:icon=</span><span class="s">&quot;@drawable/color_fill&quot;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="na">android:title=</span><span class="s">&quot;@string/action_color&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="nt">&lt;/item&gt;</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="nt">&lt;/menu&gt;</span>
</code></pre></div>
<h3 id="3-definir-le-callback">3. Définir le Callback</h3>
<p>Implémenter l'interface ActionMode.Callback dans votre Activité. L’implémentation de cette interface requiert l’implémentation de plusieurs méthodes, notamment :</p>
<ul>
<li>onCreateActionMode : comportement à la création du mode contextuel</li>
<li>onActionItemClicked : comportement au clic sur un élément de la barre contextuelle</li>
<li>onDestroyActionMode : comportement à la fermeture du mode contextuel</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onCreateActionMode</span><span class="p">(</span><span class="n">actionMode</span><span class="p">:</span><span class="w"> </span><span class="n">ActionMode</span><span class="p">,</span><span class="w"> </span><span class="n">menu</span><span class="p">:</span><span class="w"> </span><span class="n">Menu</span><span class="o">?</span><span class="p">):</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="n">inflater</span><span class="p">:</span><span class="w"> </span><span class="n">MenuInflater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionMode</span><span class="p">.</span><span class="na">menuInflater</span><span class="w"></span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="n">inflater</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">menu</span><span class="p">.</span><span class="na">context_mode_menu</span><span class="p">,</span><span class="w"> </span><span class="n">menu</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onPrepareActionMode</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span><span class="w"> </span><span class="n">ActionMode</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">:</span><span class="w"> </span><span class="n">Menu</span><span class="o">?</span><span class="p">):</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onActionItemClicked</span><span class="p">(</span><span class="n">actionMode</span><span class="p">:</span><span class="w"> </span><span class="n">ActionMode</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">menuItem</span><span class="p">:</span><span class="w"> </span><span class="n">MenuItem</span><span class="o">?</span><span class="p">):</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="p">(</span><span class="n">menuItem</span><span class="o">?</span><span class="p">.</span><span class="na">itemId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">            </span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">action_color</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">                </span><span class="n">binding</span><span class="p">.</span><span class="na">btnSet</span><span class="p">.</span><span class="na">setBackgroundColor</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">                    </span><span class="n">resources</span><span class="p">.</span><span class="na">getColor</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">                        </span><span class="n">R</span><span class="p">.</span><span class="na">color</span><span class="p">.</span><span class="na">teal_200</span><span class="w"></span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">                    </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">                </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">                </span><span class="n">actionMode</span><span class="o">?</span><span class="p">.</span><span class="na">finish</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">                </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onDestroyActionMode</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span><span class="w"> </span><span class="n">ActionMode</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="4-associer-le-callback-a-un-evenement">4. Associer le callback à un événement</h3>
<p>Enfin, il faut associer ce callback à un événement, notamment l’appui long sur le bouton. Pour cela, écrire le code suivant dans votre activité :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="w">    </span><span class="kd">private</span><span class="w">  </span><span class="n">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ActivityTestFragmentBinding</span><span class="w"></span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="c1">// code à ajouter</span><span class="w"></span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="kd">private</span><span class="w">  </span><span class="n">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="n">actionMode</span><span class="p">:</span><span class="w"> </span><span class="n">ActionMode</span><span class="w"></span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle</span><span class="o">?</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityTestFragmentBinding</span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="na">root</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="n">supportFragmentManager</span><span class="p">.</span><span class="na">beginTransaction</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">            </span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">fragment</span><span class="p">,</span><span class="n">FragmentClock</span><span class="p">(),</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">            </span><span class="p">.</span><span class="na">addToBackStack</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">            </span><span class="p">.</span><span class="na">commit</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">            </span><span class="c1">// code à ajouter</span><span class="w"></span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">       </span><span class="n">binding</span><span class="p">.</span><span class="na">btnSet</span><span class="p">.</span><span class="na">setOnLongClickListener</span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">           </span><span class="n">actionMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="nd">@TestFragmentActivity.startActionMode</span><span class="p">(</span><span class="k">this</span><span class="nd">@TestFragmentActivity</span><span class="p">)</span><span class="o">!!</span><span class="w"></span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">           </span><span class="k">return</span><span class="nd">@setOnLongClickListener</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">       </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Activité 3</p>
<p>Vous savez ce que vous avez à faire...</p>
</div>
<h2 id="homework">Homework</h2>
<p>L’un des principaux avantages des fragments est la facilité qu’ils offrent quand il s’agit de s’adapter à des tailles d’écrans différentes.
1. Implémenter un exemple simple montrant comment est-ce qu’une application avec des fragments réagit sur différentes tailles d’écran, en utilisant les <em>multi-pane layouts</em>.
2. Ajouter une petite fonctionnalité dans la barre d’options, permettant à l’application de passer d’un thème à un autre (deux thèmes peuvent être définis statiquement).</p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../tp2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: TP2: Éléments Graphiques avancés : RecyclerView" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              TP2: Éléments Graphiques avancés : RecyclerView
            </div>
          </div>
        </a>
      
      
        
        <a href="../tp4/" class="md-footer__link md-footer__link--next" aria-label="Next: TP4: Stockage de données et Firebase" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              TP4: Stockage de données et Firebase
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Safa Telli
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2ab50757.min.js"></script>
      
    
  </body>
</html>