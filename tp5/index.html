
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.3">
    
    
      
        <title>TP5: Connexion à des services web REST - TP-Android-GL4 2022-2023</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6b80c2a2.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tp-5-connexion-a-des-services-web-rest" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="TP-Android-GL4 2022-2023" class="md-header__button md-logo" aria-label="TP-Android-GL4 2022-2023" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TP-Android-GL4 2022-2023
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TP5: Connexion à des services web REST
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="TP-Android-GL4 2022-2023" class="md-nav__button md-logo" aria-label="TP-Android-GL4 2022-2023" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    TP-Android-GL4 2022-2023
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp0/" class="md-nav__link">
        TP0: Intitiation au langage Kotlin
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp1/" class="md-nav__link">
        TP1: Création des interfaces graphiques et navigation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp2/" class="md-nav__link">
        TP2: Éléments Graphiques avancés : RecyclerView
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp3/" class="md-nav__link">
        TP3: Création des Fragments
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tp4/" class="md-nav__link">
        TP4: Stockage de données et Firebase
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          TP5: Connexion à des services web REST
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        TP5: Connexion à des services web REST
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs-du-tp" class="md-nav__link">
    Objectifs du TP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#i-les-web-services" class="md-nav__link">
    I. Les web services
  </a>
  
    <nav class="md-nav" aria-label="I. Les web services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1le-besoin-dutiliser-le-service-web-dans-les-applications-android" class="md-nav__link">
    1.Le besoin d'utiliser le service Web dans les applications Android
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ii-retrofit" class="md-nav__link">
    II. Retrofit
  </a>
  
    <nav class="md-nav" aria-label="II. Retrofit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-declaration-dapis" class="md-nav__link">
    1. Déclaration d’APIs :
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-format-de-donnees" class="md-nav__link">
    2. Format de Données
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii-exercice-acces-a-un-service-web" class="md-nav__link">
    III. Exercice : Accès à un Service Web
  </a>
  
    <nav class="md-nav" aria-label="III. Exercice : Accès à un Service Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-generation-des-classes-data-a-partir-des-donnees-json" class="md-nav__link">
    2. Génération des classes data à partir des données JSON
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creation-de-linterface-graphique" class="md-nav__link">
    3. Création de l’interface graphique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interface-restinterface" class="md-nav__link">
    4. Interface RestInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-retrofit-builder" class="md-nav__link">
    5. Retrofit Builder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-ajout-de-parametres" class="md-nav__link">
    7. Ajout de paramètres
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-liste-de-choix" class="md-nav__link">
    8. Liste de Choix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-liste-des-previsions" class="md-nav__link">
    9. Liste des prévisions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objectifs-du-tp" class="md-nav__link">
    Objectifs du TP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#i-les-web-services" class="md-nav__link">
    I. Les web services
  </a>
  
    <nav class="md-nav" aria-label="I. Les web services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1le-besoin-dutiliser-le-service-web-dans-les-applications-android" class="md-nav__link">
    1.Le besoin d'utiliser le service Web dans les applications Android
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ii-retrofit" class="md-nav__link">
    II. Retrofit
  </a>
  
    <nav class="md-nav" aria-label="II. Retrofit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-declaration-dapis" class="md-nav__link">
    1. Déclaration d’APIs :
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-format-de-donnees" class="md-nav__link">
    2. Format de Données
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iii-exercice-acces-a-un-service-web" class="md-nav__link">
    III. Exercice : Accès à un Service Web
  </a>
  
    <nav class="md-nav" aria-label="III. Exercice : Accès à un Service Web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-objectif" class="md-nav__link">
    1. Objectif
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-generation-des-classes-data-a-partir-des-donnees-json" class="md-nav__link">
    2. Génération des classes data à partir des données JSON
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-creation-de-linterface-graphique" class="md-nav__link">
    3. Création de l’interface graphique
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-interface-restinterface" class="md-nav__link">
    4. Interface RestInterface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-retrofit-builder" class="md-nav__link">
    5. Retrofit Builder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-ajout-de-parametres" class="md-nav__link">
    7. Ajout de paramètres
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-liste-de-choix" class="md-nav__link">
    8. Liste de Choix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-liste-des-previsions" class="md-nav__link">
    9. Liste des prévisions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="tp-5-connexion-a-des-services-web-rest">TP 5 Connexion à des services web REST</h1>
<p><center><img alt="Adapter" src="../assets/tp5/capt0.jpeg" /></center></p>
<h2 id="objectifs-du-tp">Objectifs du TP</h2>
<p>Interrogation de services web REST à partir de votre application Android avec la bibliothèque Retrofit en suivant l'architecture MVVM.</p>
<h2 id="i-les-web-services">I. Les web services</h2>
<p>Un service Web est une norme utilisée pour échanger des informations entre des applications ou des systèmes de type hétérogène. Les applications logicielles écrites dans divers langages de programmation et s'exécutant sur diverses plates-formes peuvent utiliser des services Web pour échanger des informations sur Internet à l'aide du protocole http.</p>
<h3 id="1le-besoin-dutiliser-le-service-web-dans-les-applications-android">1.Le besoin d'utiliser le service Web dans les applications Android</h3>
<p>Les applications Web existantes ont également besoin de créer des applications mobiles pour montrer leur présence dans la plate-forme mobile. Exposer les fonctionnalités existantes des applications est un peu difficile car toutes les fonctionnalités doivent être réécrites dans les plates-formes respectives. Mais il peut être facilement réalisé avec beaucoup de facilité en créant un service Web et en exposant les fonctionnalités existantes en tant que méthodes Web aux plateformes mobiles.
Voici les quelques avantages de l'utilisation de Web Service sous Android:
- Rendre le client plus léger.
- Réutilisation des fonctionnalités existantes.
- Utilisation d'une base de données distante.</p>
<p>Voici une architecture simplifée d'une application Android qui utilise des web services :</p>
<p><center><img alt="Adapter" src="../assets/tp5/webservex.png" /></center></p>
<h2 id="ii-retrofit">II. Retrofit</h2>
<p>Retrofit  est un client REST pour Android et Java, permettant de grouper et organiser toutes vos APIs de manière simple et propre.
Les annotations sont utilisées pour contrôler les paramètres d’appel de l’API, définies dans des interfaces, que vous appelez à partir de classes.
Toutes les APIs http sont représentées sous forme d’interfaces, comme suit :
<center><img alt="Adapter" src="../assets/tp5/capt1.png" /></center></p>
<h3 id="1-declaration-dapis">1. Déclaration d’APIs :</h3>
<p>Chaque méthode doit avoir une annotation http qui fournit la méthode utilisée ainsi que l’URL. 5 annotations sont fournies : GET, POST, PUT, DELETE et HEAD. Voici un exemple d’appel :
<center><img alt="Adapter" src="../assets/tp5/cap2.png" /></center></p>
<p>Il est possible de spécifier les paramètres de la requête dans l’URL :
<center><img alt="Adapter" src="../assets/tp5/capt3.png" /></center></p>
<p>Pour un remplacement dynamique de blocs et de paramètres dans la méthode, utiliser : {}, puis référencer ce bloc avec l’annotation @ PATH, comme suit :
  <center><img alt="Adapter" src="../assets/tp5/capt4.png" /></center></p>
<p>Il est également possible d’utiliser des paramètres de requêtes (query parameters)
comme suit :
<center><img alt="Adapter" src="../assets/tp5/capt5.png" /></center></p>
<p>L’URL résultante sera alors comme suit : <strong>group/id_val/users ?sort=sort_val</strong></p>
<p>Pour insérer plusieurs paramètres de requête à la fois, utiliser une Map:
<center><img alt="Adapter" src="../assets/tp5/capt6.png" /></center></p>
<p>Consulter le site de <a href="" title="https://square.github.io/retrofit/">Retrofit</a> pour plus d’exemples d’utilisation de Retrofit.</p>
<h3 id="2-format-de-donnees">2. Format de Données</h3>
<p>Par défaut, Retrofit peut seulement dé-sérialiser les HTTP bodies en objets
ResponseBody de la bibliothèque OkHttp, et n’accepte les requêtes que sous format
RequestBody pour le @Body.
Cependant, un ensemble de convertisseurs sont disponibles pour supporter d’autres
types, dont Gson. Gson est une librairie Java utilisée pour convertir les objets Java en
leur représentation JSON, et vice-versa.</p>
<p>Pour supporter Retrofit, il faut d’abord ajouter deux dépendances :</p>
<ol>
<li>Librairie Retrofit</li>
<li>Gson</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Activité 1</p>
<p>Créer un projet Android TP5. Ajouter les dépendances pour Retrofit et
  gson dans le fichier build.gradle (du Module), en insérant les lignes suivantes dans la
  partie dependencies:</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>implementation(&quot;com.squareup.retrofit2:retrofit:2.9.0&quot;)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>implementation &#39;com.squareup.retrofit2:converter-gson:2.3.0
</code></pre></div>
<p>N’oubliez pas de synchroniser le projet pour que les dépendances soient prises en
compte !</p>
<h2 id="iii-exercice-acces-a-un-service-web">III. Exercice : Accès à un Service Web</h2>
<h3 id="1-objectif">1. Objectif</h3>
<p>Durée estimée de l’exercice : 2h</p>
<p>L’objectif de ce TP est de réaliser une application android qui accède à des données provenant d’un service web externe.</p>
<p><center><img alt="Adapter" src="../assets/tp5/exercice.png" /></center></p>
<h3 id="2-generation-des-classes-data-a-partir-des-donnees-json">2. Génération des classes data à partir des données JSON</h3>
<p>Le service web que nous appelons est un service public de consultation de météo.
Pour consulter la météo actuelle à Tunis, nous utilisons l’URI suivante :<a href="" title="http://api.openweathermap.org/data/2.5/weather?q=Tunis&amp;APPID=17db59488cadcad345211c36304a9266">http://api.openweathermap.org/data/2.5/weather?q=Tunis&amp;APPID=17db59488cadcad345211c36304a9266</a></p>
<p>La réponse obtenue ressemble à la suivante :</p>
<p><center><img alt="Adapter" src="../assets/tp5/json.png" /></center></p>
<p>Pour obtenir un APPID valide, il suffit de s’inscrire sur le site http://openweathermap.org , un APPID sera généré pour vous, vous le trouverez dans votre profil. Il suffira ensuite de remplacer le APPID de l’URI précédente par la votre. Une fois une réponse valide obtenue, sous la forme d’un document JSON comme le montre la figure précédente, il est possible de générer les classes POJO que vous allez utiliser pour manipuler les données du service web à votre guise.
Pour cela :</p>
<p>• Copier la réponse que vous obtenez de l'API
• Faites un clic droit sur le package  et sélectionnez New-&gt; Kotlin-data class from JSON
• Donner à ce fichier un nom approprié.
<center><img alt="data" src="../assets/tp5/kotlin.png" /></center>
• 7 classes de données seront générées.</p>
<p><center><img alt="data" src="../assets/tp5/dataclass.png" /></center></p>
<h3 id="3-creation-de-linterface-graphique">3. Création de l’interface graphique</h3>
<p>Commencer par créer l'interface graphique suivante : 
<center><img alt="data" height="100" src="../assets/tp5/ui.png" /></center>
Ajouter également, dans le fichier Manifest, la permission d’accès à internet :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<h3 id="4-interface-restinterface">4. Interface RestInterface</h3>
<p>• Créer une interface appelée RestInterface dans votre projet. Cette interface
permettra de mapper une URI donnée à un appel de méthode, grâce aux
annotations fournies par l’API Retrofit.
• Pour obtenir la météo de Tunis, le code de RestInterface devra être comme suit :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">interface</span> <span class="nc">WeatherAPI</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">   </span><span class="nd">@GET</span><span class="p">(</span><span class="s">&quot;weather?q=Tunis&amp;APPID=17db59488cadcad345211c36304a9266&quot;</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">   </span><span class="n">fun</span><span class="w"> </span><span class="nf">getWeather</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Call</span><span class="o">&lt;</span><span class="n">WeatherResponse</span><span class="o">&gt;</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Vous remarquerez ici que l’URI commence par weather. En effet, le path principal sera
indiqué dans la classe principale, lors de l’appel du service.</p>
<h3 id="5-retrofit-builder">5. Retrofit Builder</h3>
<p>Créer une nouvelle classe RetrofitHelper et y insérer le code suivant. Retrofit Builder nous permet de construire la requête:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">object</span><span class="w"> </span><span class="n">RetrofitHelper</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="s">&quot;https://api.openweathermap.org/data/2.5/&quot;</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">   </span><span class="cm">/**</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="cm">    * The Retrofit object with Gson converter.</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="cm">    */</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">   </span><span class="kd">private</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Retrofit</span><span class="p">.</span><span class="na">Builder</span><span class="p">().</span><span class="na">baseUrl</span><span class="p">(</span><span class="n">baseUrl</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">           </span><span class="p">.</span><span class="na">addConverterFactory</span><span class="p">(</span><span class="n">GsonConverterFactory</span><span class="p">.</span><span class="na">create</span><span class="p">())</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">           </span><span class="c1">// we need to add converter factory to</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">           </span><span class="c1">// convert JSON object to Java object</span><span class="w"></span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">           </span><span class="p">.</span><span class="na">build</span><span class="p">()</span><span class="w"></span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">   </span><span class="cm">/**</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="cm">    * A public Api object that exposes the lazy-initialized Retrofit service</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="cm">    */</span><span class="w"></span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">   </span><span class="n">val</span><span class="w"> </span><span class="n">retrofitService</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WeatherAPI</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">lazy</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">retrofit</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">WeatherAPI</span><span class="p">::</span><span class="kd">class</span><span class="err">.</span><span class="nc">java</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>En Kotlin, les déclarations d'objets servent à déclarer des objets singleton. Le schéma singleton garantit qu'une seule et unique instance d'un objet est créée et qu'elle possède un point d'accès global à cet objet.
Le langage Kotlin permet de déclarer facilement des singletons. Vous trouverez ci-dessous un exemple de déclaration d'objet et de son accès. Le nom de la déclaration d'objet est toujours suivi du mot clé object (objet).</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// Object declaration</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">object</span><span class="w"> </span><span class="n">DataProviderManager</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="nf">registerDataProvider</span><span class="p">(</span><span class="n">provider</span><span class="p">:</span><span class="w"> </span><span class="n">DataProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">        </span><span class="c1">// ...</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="err">​</span><span class="w"></span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">allDataProviders</span><span class="p">:</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">DataProvider</span><span class="o">&gt;</span><span class="w"></span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// ...</span><span class="w"></span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1">// To refer to the object, use its name directly.</span><span class="w"></span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="n">DataProviderManager</span><span class="p">.</span><span class="na">registerDataProvider</span><span class="p">(...)</span><span class="w"></span>
</code></pre></div>
<p>L’URL utilisée ici est une chaîne statique représentant l’URL principale fixe du web service
http://api.openweathermap.org/data/2.5/</p>
<div class="admonition tip">
<p class="admonition-title">Activité 2</p>
<ul>
<li>Faire le travail nécessaire, pour consommer l'API fournit afin d'afficher les données sur la météo de Tunis.</li>
<li>Vous devez appliquer l'architecture <strong><em>MVVM</em></strong> vu en cours .</li>
</ul>
</div>
<h3 id="7-ajout-de-parametres">7. Ajout de paramètres</h3>
<p>Nous aimerions maintenant que l’appel au web service soit paramétré. C’est à dire que le nom de la ville dont on va afficher la météo sera passé en paramètre à l’appel de la fonction getWeather, et non pas en dur directement dans RestInterface.</p>
<div class="admonition tip">
<p class="admonition-title">Activité 3</p>
<p>Ajouter un paramètre à la fonction getWeather.</p>
</div>
<h3 id="8-liste-de-choix">8. Liste de Choix</h3>
<p>Pour obtenir le résultat final, comme montré dans la partie II.1, il faut définir une liste déroulante (spinner), dans lequel on trouvera les noms des villes dont nous voulons afficher la météo.</p>
<div class="admonition tip">
<p class="admonition-title">Activité 4</p>
<p>Ajouter une liste déroulante à votre activité. Insérer les noms des villes de
votre choix. Modifier votre code de façon à ce que l’appel au service web change selon le nom de la ville sélectionnée.</p>
</div>
<h3 id="9-liste-des-previsions">9. Liste des prévisions</h3>
<p>On souhaite maintenant afficher la prévisions météorologiques à 16 jours.</p>
<div class="admonition tip">
<p class="admonition-title">Activité 5</p>
<ul>
<li>Ajouter un Button qui amène à une nouvelle Activity contenant un RecyclerView qui affiche la liste des prévisions métrologiques de la ville selectionnée.</li>
<li>Penser à utiliser l'API suivant : <a href="" title="https://api.openweathermap.org/data/2.5/forecast/daily?q=Tunis&amp;APPID=17db59488cadcad345211c36304a9266">lien</a></li>
<li>Appliquer l'architecture MVVM.</li>
</ul>
</div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../tp4/" class="md-footer__link md-footer__link--prev" aria-label="Previous: TP4: Stockage de données et Firebase" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              TP4: Stockage de données et Firebase
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Safa Telli
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2ab50757.min.js"></script>
      
    
  </body>
</html>